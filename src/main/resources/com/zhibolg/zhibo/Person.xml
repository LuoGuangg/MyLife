<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zhibolg.zhibo.dao.PersonDao">
	
	<sql id="personColumns">
		a.id AS "id",
		a.rank AS "rank",
		a.name AS "name",
		a.category AS "category",
		a.birth AS "birth",
		a.sex AS "sex",
		a.phone AS "phone",
		a.qq AS "qq",
		a.create_by AS "create_by.id",
		a.create_date AS "createDate",
		a.update_by AS "update_by.id",
		a.update_date AS "update_date",
		a.del_flag AS "delFlag"	
	</sql>
	
		
	<sql id="personRelationColumns">
		a.id AS "id",
		a.source AS "source",
		a.target AS "target",
		a.relation AS "relation",
		a.create_by AS "create_by.id",
		a.create_date AS "createDate",
		a.update_by AS "update_by.id",
		a.update_date AS "update_date",
		a.del_flag AS "delFlag"	
	</sql>
	
	<!-- 查询人物列表 -->
	<select id="findListPerson" resultType="com.zhibolg.zhibo.entity.Person">
		SELECT 
			<include refid="personColumns"/>
		FROM person a
		<where>
		del_flag = '0'
		AND
		a.create_by = #{createBy.id}
		</where>
		ORDER BY a.rank 
	</select>
	
	<!-- 查询人物列表 -->
	<select id="findListPersonByRank" resultType="com.zhibolg.zhibo.entity.Person">
		SELECT 
			<include refid="personColumns"/>
		FROM person a
		<where>
		del_flag = '0'
		
		</where>
		ORDER BY a.rank 
	</select>
	
	<!-- 查询人物 -->
	<select id="get" resultType="com.zhibolg.zhibo.entity.Person">
		SELECT 
			<include refid="personColumns"/>
		FROM person a
		<where>
		del_flag = '0'
		AND a.id = #{id}
		</where>
	</select>
	
		
	<!-- 查询人物通过姓名 -->
	<select id="getByName" resultType="com.zhibolg.zhibo.entity.Person">
		SELECT 
			<include refid="personColumns"/>
		FROM person a
		<where>
		del_flag = '0'
		AND a.name = #{name}
		</where>
	</select>
	
	
	<!-- 查询人物关系列表 -->
	<select id="findListPersonRelation" resultType="com.zhibolg.zhibo.entity.Person">
		SELECT 
			<include refid="personRelationColumns"/>
		FROM person_relation a
		<where>
		del_flag = '0'
		AND
		a.create_by = #{createBy.id}
		</where>
	</select>


	
	<!-- 获得此人物的关系列表-->
	<select id="findRelation" resultType="com.zhibolg.zhibo.entity.Person">
		SELECT 
			<include refid="personRelationColumns"/>
		FROM person_relation a
		<where>
		a.create_by = #{createBy.id} AND
		target = #{rank} OR
		source = #{rank}
		</where>
	</select>
	
	
	<!-- 插入人物 -->
	<insert id="insertPerson">
		INSERT INTO person(
			id,
			rank,
			category,
			name,
			birth,
			sex,
			phone,
			qq,
			create_by,
			create_date,
			update_by,
			update_date,
			del_flag
		) VALUE (
			#{id},
			#{rank},
			#{category},
			#{name},
			#{birth},
			#{sex},
			#{phone},
			#{qq},
			#{createBy.id},
			#{createDate},
			#{updateBy.id},
			#{updateDate},
			#{delFlag}
		)
	</insert>
	
	<!-- 插入人物关系 -->
	<insert id="insertPersonRelation">
		INSERT INTO person_relation(
			id,
			source,
			target,
			relation,
			create_by,
			create_date,
			update_by,
			update_date,
			del_flag
		) VALUE (
			#{id},
			#{source},
			#{target},
			#{relation},
			#{createBy.id},
			#{createDate},
			#{updateBy.id},
			#{updateDate},
			#{delFlag}
		)
	</insert>

</mapper>
